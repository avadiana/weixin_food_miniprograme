# 美食地图小程序项目结构

## 项目概述
这是一个用于分享和发现美食店铺的微信小程序，用户可以添加、浏览、收藏店铺信息，支持多种分类和标签功能，并提供贡献排行榜等社交功能。

## 目录结构

```
├── app.js                # 小程序入口文件，包含全局配置和状态管理
├── app.json              # 全局配置文件，定义页面路由、窗口样式等
├── app.wxss             # 全局样式文件
├── project.config.json  # 项目配置文件
├── config/              # 配置文件目录
│   └── config.js        # 项目配置参数
├── utils/               # 工具类目录
│   ├── auth.js          # 用户认证管理工具
│   ├── database.js      # 数据库操作工具
│   └── error.js         # 错误处理工具
├── models/              # 数据模型目录
│   └── user.js          # 用户数据模型
├── images/              # 图片资源目录
│   ├── all.svg          # 全部分类图标
│   ├── breakfast.svg    # 早餐分类图标
│   ├── lunch.svg        # 正餐分类图标
│   ├── tea.svg          # 喝茶分类图标
│   ├── coffee.svg       # 咖啡分类图标
│   ├── bar.svg          # 酒吧分类图标
│   ├── night.svg        # 夜宵分类图标
│   ├── book-grain.svg   # 书店谷子图标
│   ├── other.svg        # 其他分类图标
│   ├── back.svg         # 返回按钮图标
│   ├── copy.svg         # 复制按钮图标
│   ├── delete.svg       # 删除按钮图标
│   ├── edit.svg         # 编辑按钮图标
│   ├── favorite.svg     # 收藏按钮图标
│   ├── favorite-fill.svg # 已收藏图标
│   ├── heart.svg        # 心形图标
│   ├── heart-filled.svg # 实心心形图标
│   ├── home.svg         # 主页图标
│   ├── marker.svg       # 地图标记图标
│   ├── navigation.svg   # 导航图标
│   ├── ranking.svg      # 排行榜图标
│   ├── refresh.svg      # 刷新图标
│   ├── search.svg       # 搜索图标
│   ├── share.svg        # 分享图标
│   ├── shop.svg         # 店铺图标
│   ├── shop-active.svg  # 店铺激活图标
│   ├── user.svg         # 用户图标
│   └── user-active.svg  # 用户激活图标
├── pages/               # 页面目录
│   ├── list/           # 店铺列表页
│   │   ├── list.js     # 列表页逻辑
│   │   ├── list.json   # 列表页配置
│   │   ├── list.wxml   # 列表页结构
│   │   └── list.wxss   # 列表页样式
│   ├── add/            # 添加店铺页
│   ├── edit/           # 编辑店铺页
│   ├── shop-detail/    # 店铺详情页
│   ├── user/           # 用户中心页
│   ├── my-shops/       # 我的店铺页
│   ├── my-favorites/   # 我的收藏页
│   └── ranking/        # 贡献排行榜页
└── cloudfunctions/     # 云函数目录
    ├── login/          # 登录云函数
    ├── updateUser/     # 更新用户信息云函数
    ├── getLocation/    # 地理位置解析云函数
    └── decryptData/    # 数据解密云函数
```

## 核心功能模块

### 1. 用户认证模块
- 微信登录授权
- 用户信息获取
- 头像和昵称设置
- 隐私协议授权
- 会话管理

### 2. 店铺管理模块
- 店铺信息添加
- 店铺信息编辑
- 店铺信息删除
- 图片上传管理
- 地理位置解析
- 分类管理

### 3. 标签系统
- 预设标签选择
- 自定义标签添加
- 标签展示和管理
- 标签筛选功能

### 4. 图片管理
- 店铺图片（最多9张）
- 菜单图片（最多5张）
- 图片预览功能
- 图片删除功能
- 云存储集成

### 5. 收藏功能
- 店铺收藏/取消
- 收藏列表管理
- 收藏状态同步
- 收藏数据统计

### 6. 用户中心
- 个人信息管理
- 贡献店铺统计
- 收藏店铺统计
- 数据同步功能
- 贡献排行榜入口

### 7. 列表展示
- 分类筛选
- 瀑布流布局
- 下拉刷新
- 上拉加载
- 搜索功能
- 店铺名称复制

### 8. 数据存储
- 云数据库集成
- 本地存储管理
- 数据同步机制
- 缓存管理

### 9. 界面交互
- 自定义导航栏
- 加载状态提示
- 操作反馈提示
- 页面间导航
- 分享功能

### 10. 排行榜系统
- 用户贡献统计
- 排名动态计算
- 前三名特殊展示
- 实时更新排名
- 动画效果展示

## 技术特点
- 使用微信小程序云开发
- 采用组件化开发方式
- 统一的错误处理机制
- 完善的用户体验设计
- 响应式界面适配
- 性能优化措施
- 动画交互效果

## 数据库集合

### shops 集合
- 存储店铺信息
- 字段说明:
  - `name`: 店铺名称
  - `address`: 店铺地址
  - `category`: 店铺分类
  - `averagePrice`: 人均消费
  - `photos`: 店铺图片数组
  - `menuPhotos`: 菜单图片数组
  - `creator`: 创建者信息
  - `createTime`: 创建时间
  - `tags`: 店铺标签数组
  - `updateTime`: 更新时间

### favorites 集合
- 存储收藏记录
- 字段说明:
  - `userId`: 用户ID
  - `shopId`: 店铺ID
  - `createTime`: 收藏时间

## 全局配置

### app.js
- 全局数据管理
- 用户登录状态管理
- 全局分类数据
- 全局主题配置

### app.json
- 页面路由配置
- 全局窗口配置
- 底部导航配置
- 自定义导航栏配置

### app.wxss
- 全局样式定义
- 公共组件样式
- 动画效果样式

## 主要功能流程

1. **店铺浏览流程**
   - 列表页展示店铺
   - 支持分类筛选
   - 支持搜索
   - 点击进入详情页
   - 支持店铺名称和地址复制

2. **店铺发布流程**
   - 用户登录
   - 进入发布页
   - 填写信息并上传图片
   - 提交保存
   - 更新排行榜数据

3. **收藏功能流程**
   - 用户登录
   - 点击收藏按钮
   - 更新收藏状态
   - 可在用户中心查看收藏列表

4. **排行榜功能流程**
   - 计算用户贡献数据
   - 生成排行榜
   - 展示特殊效果
   - 支持实时更新

## 注意事项

1. 图片上传
   - 限制图片大小和数量
   - 使用云存储
   - 压缩图片质量

2. 数据安全
   - 权限验证
   - 数据校验
   - 敏感信息过滤

3. 性能优化
   - 分页加载
   - 图片懒加载
   - 数据缓存
   - 动画性能优化

## 后续优化方向

1. 用户体验
   - 添加店铺评分功能
   - 添加评论功能
   - 优化图片加载体验
   - 完善动画效果

2. 社交功能
   - 添加分享功能
   - 添加用户关注功能
   - 添加动态功能
   - 完善排行榜互动

3. 数据分析
   - 添加访问统计
   - 添加热门排行
   - 添加推荐功能
   - 数据可视化展示

## 页面结构

### pages/list/list
店铺列表页
- 显示所有店铺信息
- 支持按分类筛选
- 显示店铺基本信息、地址(带复制功能)
- 显示店铺标签
- 创建者可以编辑/删除
- 支持收藏功能
- 支持店铺名称复制

### pages/add/add
添加店铺页
- 支持输入店铺基本信息
- 支持上传店铺图片和菜单图片
- 支持选择预设标签和添加自定义标签
- 标签选中状态显示黑底白字
- 支持人均价格输入
- 支持备注信息添加

### pages/edit/edit
编辑店铺页
- 预填充已有店铺信息
- 支持修改所有店铺信息
- 支持修改标签
- 支持修改图片
- 权限验证

### pages/user/user
用户中心页
- 显示用户基本信息
- 显示贡献统计
- 显示收藏统计
- 提供功能入口
- 支持退出登录
- 支持刷新统计

### pages/my-favorites/my-favorites
我的收藏页
- 显示收藏的店铺列表
- 支持取消收藏
- 支持跳转详情
- 支持下拉刷新
- 支持加载更多

### pages/ranking/ranking
贡献排行榜页
- 显示用户贡献排名
- 特殊展示前三名
- 支持动画效果
- 支持实时更新
- 突出显示当前用户排名

## 主要功能模块

### 店铺标签功能
- 支持预设标签选择
- 支持自定义标签添加
- 标签显示在店铺卡片地址下方
- 标签使用蓝色系样式
- 选中状态为黑底白字

### 图片上传
- 支持多图上传
- 支持图片预览和删除
- 店铺图片最多9张
- 菜单图片最多5张

### 地址复制
- 店铺列表页支持
- 店铺详情页支持
- 点击复制按钮即可复制地址

### 收藏功能
- 需要登录后使用
- 可在列表页直接收藏
- 可在详情页收藏
- 我的收藏页查看收藏店铺

### 权限控制
- 需要登录才能添加店铺
- 只有创建者可以编辑删除
- 收藏功能需要登录

## 页面详细说明

### 1. 店铺列表页 (pages/list/)
- **文件结构**:
  - `list.js`: 列表页逻辑,处理分类切换、搜索、加载更多等
  - `list.wxml`: 列表页模板,包含分类栏、搜索框、瀑布流布局
  - `list.wxss`: 列表页样式,包含瀑布流、卡片样式等
  - `list.json`: 列表页配置,设置下拉刷新等
- **主要功能**:
  - 瀑布流形式展示店铺列表
  - 顶部分类栏筛选
  - 搜索店铺功能
  - 下拉刷新数据
  - 上拉加载更多
  - 店铺卡片展示(图片、名称、地址、标签等)
  - 快捷收藏功能
  - 地址复制功能

### 2. 添加店铺页 (pages/add/)
- **文件结构**:
  - `add.js`: 添加页逻辑,处理表单提交、图片上传等
  - `add.wxml`: 添加页模板,包含表单、图片上传组件等
  - `add.wxss`: 添加页样式,美化表单和交互效果
  - `add.json`: 添加页配置
- **主要功能**:
  - 店铺基本信息表单(名称、地址、分类等)
  - 店铺图片上传(最多9张)
  - 菜单图片上传(最多5张)
  - 人均消费输入
  - 标签选择和自定义
  - 备注信息添加
  - 地理位置解析
  - 表单验证
  - 提交保存

### 3. 编辑店铺页 (pages/edit/)
- **文件结构**:
  - `edit.js`: 编辑页逻辑,加载已有数据,处理更新等
  - `edit.wxml`: 编辑页模板,复用添加页的大部分结构
  - `edit.wxss`: 编辑页样式
  - `edit.json`: 编辑页配置
- **主要功能**:
  - 加载已有店铺信息
  - 修改基本信息
  - 修改/删除图片
  - 修改标签
  - 更新店铺信息
  - 权限验证

### 4. 店铺详情页 (pages/shop-detail/)
- **文件结构**:
  - `shop-detail.js`: 详情页逻辑,加载数据,处理交互等
  - `shop-detail.wxml`: 详情页模板,展示完整店铺信息
  - `shop-detail.wxss`: 详情页样式
  - `shop-detail.json`: 详情页配置
- **主要功能**:
  - 店铺完整信息展示
  - 图片轮播展示
  - 菜单图片展示
  - 地址复制功能
  - 收藏功能
  - 分享功能
  - 创建者信息展示
  - 标签展示

### 5. 用户中心页 (pages/user/)
- **文件结构**:
  - `user.js`: 用户页逻辑,处理登录、数据统计等
  - `user.wxml`: 用户页模板,展示用户信息和功能入口
  - `user.wxss`: 用户页样式
  - `user.json`: 用户页配置
- **主要功能**:
  - 用户登录/退出
  - 头像和昵称设置
  - 数据统计展示
  - 贡献店铺数量
  - 收藏店铺数量
  - 功能入口导航
  - 数据刷新

### 6. 我的店铺页 (pages/my-shops/)
- **文件结构**:
  - `my-shops.js`: 我的店铺页逻辑
  - `my-shops.wxml`: 我的店铺页模板
  - `my-shops.wxss`: 我的店铺页样式
  - `my-shops.json`: 我的店铺页配置
- **主要功能**:
  - 展示用户添加的店铺列表
  - 编辑店铺入口
  - 删除店铺功能
  - 跳转详情页
  - 地址复制
  - 下拉刷新
  - 上拉加载更多

### 7. 我的收藏页 (pages/my-favorites/)
- **文件结构**:
  - `my-favorites.js`: 收藏页逻辑
  - `my-favorites.wxml`: 收藏页模板
  - `my-favorites.wxss`: 收藏页样式
  - `my-favorites.json`: 收藏页配置
- **主要功能**:
  - 展示收藏的店铺列表
  - 取消收藏功能
  - 跳转详情页
  - 地址复制
  - 下拉刷新
  - 上拉加载更多

### 8. 贡献排行榜页 (pages/ranking/)
- **文件结构**:
  - `ranking.js`: 排行榜页逻辑
  - `ranking.wxml`: 排行榜页模板
  - `ranking.wxss`: 排行榜页样式
  - `ranking.json`: 排行榜页配置
- **主要功能**:
  - 显示用户贡献排名
  - 特殊展示前三名
  - 支持动画效果
  - 支持实时更新
  - 突出显示当前用户排名 